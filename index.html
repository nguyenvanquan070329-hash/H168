<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>H168</title>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
/* GIá»® NGUYÃŠN STYLE Cá»¦A QUÃ‚N */
body{ margin:0; font-family:Arial; background:black; color:gold; text-align:center; overflow-x:hidden; }
body::before{ content:""; position:fixed; width:100%; height:100%; background:radial-gradient(circle at center, rgba(255,140,0,0.3), black 70%); animation: fireMove 5s infinite alternate; z-index:-1; }
@keyframes fireMove{ from{transform:scale(1);} to{transform:scale(1.1);} }
.logo{ width:320px; max-width:90%; margin-top:20px; animation: glow 2s infinite alternate; }
@keyframes glow{ from{filter:drop-shadow(0 0 10px gold);} to{filter:drop-shadow(0 0 35px orange);} }
.subtitle{ font-size:20px; margin-bottom:30px; text-shadow:0 0 10px gold; }
.card{ background:rgba(0,0,0,0.6); backdrop-filter:blur(10px); border:1px solid gold; margin:15px auto; padding:15px; width:300px; border-radius:15px; box-shadow:0 0 15px rgba(255,215,0,0.4); }
input{ padding:10px; margin:6px; border-radius:5px; border:none; width:200px; }
button{ padding:8px 15px; margin:5px; background:linear-gradient(to right,gold,orange); border:none; border-radius:5px; cursor:pointer; font-weight:bold; }
button:hover{ transform:scale(1.05); }
.admin-btn{ background:red; color:white; }
.coin{ position:fixed; top:-50px; width:25px; animation:fall linear infinite; }
@keyframes fall{ to{transform:translateY(110vh);} }
</style>
</head>

<body>
<img src="logo.png" class="logo">
<div class="subtitle">LuÃ´n Äá»“ng HÃ nh CÃ¹ng Báº¡n</div>

<div id="loginPage">
  <div class="card">
    <input id="username" placeholder="TÃ i khoáº£n"><br>
    <input id="password" type="password" placeholder="Máº­t kháº©u"><br>
    <button onclick="login()">ÄÄƒng nháº­p</button>
    <p id="message"></p>
  </div>
</div>

<div id="dashboard" style="display:none;">
  <h2>ğŸ² Dá»° ÄOÃN Lá»šN BÃ‰ ğŸ²</h2>
  <div class="card">
    <p>Sá»‘ dÆ°: <span id="score">0</span></p>
    <p>Thá»i gian: <span id="time">45</span>s</p>
    <div style="font-size:60px;margin:15px;">
      <span id="dice1">ğŸ²</span><span id="dice2">ğŸ²</span><span id="dice3">ğŸ²</span>
    </div>
    <button onclick="selectChoice('big')">Chá»n Lá»šN (11-18)</button>
    <button onclick="selectChoice('small')">Chá»n BÃ‰ (3-10)</button>
    <p id="result"></p>
  </div>
  <button onclick="logout()">ÄÄƒng xuáº¥t</button>
</div>

<div id="adminPage" style="display:none;">
  <h2>ğŸ‘‘ ADMIN PANEL</h2>
  <div id="userList"></div>
  <button onclick="logout()">ÄÄƒng xuáº¥t</button>
</div>

<script>
// Cáº¤U HÃŒNH FIREBASE Cá»¦A QUÃ‚N
const firebaseConfig = { databaseURL: "https://h168-60326-default-rtdb.firebaseio.com/" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let currentUser = null;
let forcedResult = "random";
let sessionCode = 0;
let timeLeft = 45;
let selectedChoice = null;
let betAmount = 0;
let isWaiting = false;

// Äá»’NG Bá»˜ Dá»® LIá»†U ONLINE
db.ref('state').on('value', s => {
    let data = s.val();
    if(!data) return;
    timeLeft = data.t;
    sessionCode = data.sess;
    forcedResult = data.cmd;
    
    document.getElementById('time').innerText = timeLeft;
    if(document.getElementById('sessionBox')) updateSessionDisplay();
    
    if(timeLeft === 0 && !isWaiting) rollDice();
    if(timeLeft === 45) resetUI();
});

function login(){
  let u=username.value;
  let p=password.value;
  // Admin máº·c Ä‘á»‹nh theo code cá»§a Ã´ng
  if(u==="admin" && p==="123456"){
    currentUser = {username:u, role:"admin"};
    loginPage.style.display="none";
    adminPage.style.display="block";
    renderAdmin();
    startClock(); // Admin vÃ o lÃ  kÃ­ch hoáº¡t Ä‘á»“ng há»“
  } else {
    currentUser = {username:u, balance:10000, role:"user"};
    loginPage.style.display="none";
    dashboard.style.display="block";
    score.innerText = currentUser.balance;
    updateSessionDisplay();
  }
}

function startClock(){
  setInterval(() => {
    db.ref('state').once('value', s => {
      let d = s.val() || {t:45, sess:100001, cmd:'random'};
      let nt = d.t - 1;
      if(nt < 0){
        db.ref('state').update({t:45, sess: d.sess + 1, cmd:'random'});
      } else {
        db.ref('state').update({t:nt});
      }
    });
  }, 1000);
}

function renderAdmin(){
  userList.innerHTML = `
    <div class="card">
      <p><b>MÃ£ phiÃªn:</b> ${sessionCode}</p>
      <button onclick="setResult('random')">Random</button>
      <button onclick="setResult('big')">Ã‰p Lá»šN</button>
      <button onclick="setResult('small')">Ã‰p BÃ‰</button>
      <p>Lá»‡nh: ${forcedResult}</p>
    </div>`;
}

function setResult(type){ db.ref('state').update({cmd: type}); renderAdmin(); }

function selectChoice(type){
  if(isWaiting) return;
  let bet = parseInt(prompt("Nháº­p tiá»n cÆ°á»£c"));
  if(!bet || bet > currentUser.balance) return;
  selectedChoice = type;
  betAmount = bet;
  currentUser.balance -= bet;
  score.innerText = currentUser.balance;
  updateSessionDisplay();
}

function rollDice(){
  isWaiting = true;
  let d1, d2, d3;
  if(forcedResult === "big"){ d1=6; d2=5; d3=4; }
  else if(forcedResult === "small"){ d1=1; d2=2; d3=3; }
  else { d1=Math.floor(Math.random()*6)+1; d2=Math.floor(Math.random()*6)+1; d3=Math.floor(Math.random()*6)+1; }
  
  let total = d1+d2+d3;
  dice1.innerText=d1; dice2.innerText=d2; dice3.innerText=d3;

  if(selectedChoice){
    let winType = total >= 11 ? "big" : "small";
    if(selectedChoice === winType){
        currentUser.balance += betAmount * 2;
        result.innerText = "ğŸ‰ Tháº¯ng! Tá»•ng " + total;
    } else {
        result.innerText = "âŒ Thua! Tá»•ng " + total;
    }
    score.innerText = currentUser.balance;
  }
}

function resetUI(){
  isWaiting = false;
  selectedChoice = null;
  betAmount = 0;
  result.innerText = "";
  dice1.innerText="ğŸ²"; dice2.innerText="ğŸ²"; dice3.innerText="ğŸ²";
  updateSessionDisplay();
}

function updateSessionDisplay(){
  if(!document.getElementById("sessionBox")){
    let div=document.createElement("div"); div.id="sessionBox";
    document.querySelector("#dashboard .card").appendChild(div);
  }
  sessionBox.innerHTML = `<b>MÃ£ phiÃªn:</b> ${sessionCode}<br><b>Cá»­a:</b> ${selectedChoice||'ChÆ°a chá»n'}`;
}

function logout(){ location.reload(); }

// HIá»†U á»¨NG TIá»€N RÆ I (GIá»® NGUYÃŠN)
function createCoin(){
  let coin=document.createElement("img");
  coin.src="https://cdn-icons-png.flaticon.com/512/138/138292.png";
  coin.className="coin";
  coin.style.left=Math.random()*100+"vw";
  coin.style.animationDuration=(3+Math.random()*3)+"s";
  document.body.appendChild(coin);
  setTimeout(()=>coin.remove(),6000);
}
setInterval(createCoin,800);
</script>
</body>
</html>
